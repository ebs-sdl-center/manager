import{u as B,b as $}from"./colorUtil-CTSWlwmt.js";import{d as _,c as I,r,o as T,w as A,a as i,F as w,b as l,e as h,f as d,g as K,n as P,u as V,t as p,h as H,i as N}from"./index-BOQCAbCB.js";const W={class:"relative",id:"map",style:{width:"100%",height:"calc(100vh - 3rem)",margin:"0",padding:"0"}},Z={class:"absolute top-0 left-0 z-10 h-30 w-full overflow-y-auto rounded bg-white/85 p-2 shadow md:h-60 md:w-max"},O=["onClick"],j=_({__name:"KakaoMap",setup(x){const c=B(),m=I(()=>{const o=new Map;for(const e of[...c.centers]){let s=o.get(e.group_id);s||(s={group_id:e.group_id,group_name:e.group_name??null,group_chief:e.group_chief??null,group_color:e.group_color??null,centers:[]},o.set(e.group_id,s)),s.centers.push(e)}return Array.from(o.values()).sort((e,s)=>e.group_id-s.group_id)}),a=r(null),y=()=>{const o=document.createElement("script");o.src="//dapi.kakao.com/v2/maps/sdk.js?appkey=f0b2d739025f158d63463df9837d6e0c&autoload=false",o.onload=()=>{window.kakao.maps.load(k)},o.onerror=()=>new Error("Failed to load script"),document.head.appendChild(o)},f=r([]),u=r([]),b=r(),E=r(0),v=r(!1),k=()=>{try{const o=document.getElementById("map"),e={center:new window.kakao.maps.LatLng(36.450701,127.770667),level:13};a.value=new window.kakao.maps.Map(o,e);const s=new window.kakao.maps.ZoomControl;a.value.addControl(s,window.kakao.maps.ControlPosition.RIGHT),b.value=new window.kakao.maps.LatLngBounds,window.kakao.maps.event.addListener(a.value,"zoom_changed",function(){const n=a.value.getLevel();E.value=n,n<10?g(!0):g(!1)});let t=null;v.value&&(t=new window.kakao.maps.Marker({position:a.value.getCenter()}),t.setMap(a.value)),window.kakao.maps.event.addListener(a.value,"click",function(n){a.value.getLevel()>=10&&g(!1),v.value&&(t.setPosition(n.latLng),console.log("click event",n.latLng))})}catch(o){console.error("Error loading Kakao Maps script:",o)}},L=()=>{a.value&&c.centers.length!==0&&(a.value.setLevel(13),a.value.setCenter(new window.kakao.maps.LatLng(36.450701,127.770667)))},D=()=>{if(!a.value){console.warn("Map is not initialized yet");return}f.value.forEach(o=>o.setMap(null)),m.value.forEach(o=>{o.centers.forEach(e=>{const t=`data:image/svg+xml,%3Csvg%20width%3D%22800px%22%20height%3D%22800px%22%20viewBox%3D%22-1%200%2036%2036%22%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20xmlns%3Axlink%3D%22http%3A%2F%2Fwww.w3.org%2F1999%2Fxlink%22%3E%3Cg%20stroke%3D%22none%22%20stroke-width%3D%221%22%20fill%3D%22none%22%20fill-rule%3D%22evenodd%22%3E%3Cg%20transform%3D%22translate%28-125.000000%2C%20-643.000000%29%22%3E%3Cg%20transform%3D%22translate%2837.000000%2C%20169.000000%29%22%3E%3Cg%20transform%3D%22translate%2878.000000%2C%20468.000000%29%22%3E%3Cg%20transform%3D%22translate%2810.000000%2C%206.000000%29%22%3E%3Cpath%20d%3D%22M14%2C0%20C21.732%2C0%2028%2C5.641%2028%2C12.6%20C28%2C23.963%2014%2C36%2014%2C36%20C14%2C36%200%2C24.064%200%2C12.6%20C0%2C5.641%206.268%2C0%2014%2C0%20Z%22%20id%3D%22Shape%22%20stroke%3D%22%23111111%22%20fill%3D%22%23${o.group_color?.replace("#","")||"888888"}%22%3E%3C%2Fpath%3E%3Ccircle%20id%3D%22Oval%22%20fill%3D%22%23fefefe%22%20fill-rule%3D%22nonzero%22%20cx%3D%2214%22%20cy%3D%2214%22%20r%3D%227%22%3E%3C%2Fcircle%3E%3C%2Fg%3E%3C%2Fg%3E%3C%2Fg%3E%3C%2Fg%3E%3C%2Fg%3E%3C%2Fsvg%3E`,n=new window.kakao.maps.Marker({image:new window.kakao.maps.MarkerImage(t,new window.kakao.maps.Size(32,35)),title:e.name,position:new window.kakao.maps.LatLng(e.lat,e.lng)});n.setMap(a.value),f.value.push(n);const F=`<div class ="bg-white/85 border border-gray-800 px-3 py-1.5 rounded-xl">        <div class="center font-bold">${e.name}</div>        <div class="text-sm">소속거점: ${e.group_name}</div>        <div class="text-sm">센터장: ${e.group_chief??"(미지정)"}</div>        <div class="text-sm">개소일: ${e.open_ymd??"(미확정)"}</div>      </div>`,z=n.getPosition(),C=new window.kakao.maps.CustomOverlay({position:z,content:F,yAnchor:1.4});window.kakao.maps.event.addListener(n,"click",function(){a.value.getLevel()>=10&&(u.value.forEach(S=>S.setMap(null)),C.setMap(a.value))}),u.value.push(C)})})},g=(o=!1)=>{o?u.value.forEach(e=>e.setMap(a.value)):u.value.forEach(e=>e.setMap(null))},M=o=>{if(!a.value)return;const e=new window.kakao.maps.LatLng(o.lat,o.lng);a.value.setCenter(e),a.value.setLevel(5)};return T(()=>{!window.kakao||!window.kakao.maps?(console.log("Kakao Maps script not loaded, loading now..."),y()):(console.log("Kakao Maps script already loaded"),k())}),A(()=>c.centers,o=>{console.log("Centers updated:",o),D()},{deep:!0}),(o,e)=>(d(),i(w,null,[l("div",{class:"flex h-12 items-center px-6"},[e[0]||(e[0]=l("h3",{class:"mr-4 text-xl font-black text-gray-700"},"EBS 자기주도학습센터 지도",-1)),e[1]||(e[1]=l("a",{href:"/manager/list",class:"rounded-full border border-sky-600 px-4 py-0.5 text-sky-800"},"센터 리스트 보기",-1)),l("div",{class:"ml-auto cursor-pointer rounded-full border border-gray-600 px-4 py-0.5 text-gray-600 hover:bg-gray-100",onClick:L}," 전체 지도 ")]),l("div",W,[l("div",Z,[(d(!0),i(w,null,h(m.value,s=>(d(),i("div",{key:s.group_id,class:"mb-1"},[(d(!0),i(w,null,h(s.centers,t=>(d(),i("div",{key:t.id,class:"mb-1"},[l("div",{class:"flex w-full cursor-pointer items-center py-0.5 hover:bg-amber-100",onClick:n=>M(t)},[l("span",{class:"mr-2 ml-1 rounded-full px-1.5 py-0.5",style:P([{backgroundColor:s.group_color??"#888888",color:V($)(s.group_color??"#888888").color},{"font-size":"x-small"}])},p(t.group_name),5),K(" "+p(t.name)+" "+p(t.group_chief?`(${t.group_chief})`:"(미지정)")+" ",1),l("span",{class:H(["mr-2 ml-1 rounded-full px-1 text-white",{"bg-amber-600":t.is_moe_budget,"bg-blue-400":!t.is_moe_budget}]),style:{"font-size":"x-small"}},p(t.is_moe_budget?"특교":"지자체"),3)],8,O)]))),128))]))),128))])])],64))}}),R={class:"map-container"},Q=_({__name:"MapView",setup(x){return(c,m)=>(d(),i("div",R,[N(j)]))}});export{Q as default};
