import{d as B,c as q,r as m,o as J,a as Q,w as X,b as d,e as u,f as n,g as Y,h as G,v as ee,F as $,i as I,j as oe,n as ae,u as te,t as _,k as se,l as ne}from"./index-DEj0ENPb.js";import{u as le,b as re}from"./colorUtil-RFfkswKR.js";const ie={class:"super-wrapper"},ce={class:"flex h-12 items-center justify-between px-6"},de={class:"inline-flex items-center"},ue={class:"mr-4 flex items-center"},pe={key:0,class:"mr-2 text-sm"},me={class:"relative",id:"map",style:{width:"100%",height:"calc(100vh - 3rem)",margin:"0",padding:"0"}},ve={class:"absolute top-0 left-0 z-10 hidden h-30 w-full overflow-y-auto rounded bg-white/85 p-2 shadow md:block md:h-60 md:w-max"},fe=["onClick"],ke=B({__name:"KakaoMap",setup(O){const f=le(),y=q(()=>{const o=new Map;for(const e of[...f.centers]){let a=o.get(e.group_id);a||(a={group_id:e.group_id,group_name:e.group_name??null,group_chief:e.group_chief??null,group_color:e.group_color??null,centers:[]},o.set(e.group_id,a)),a.centers.push(e)}return Array.from(o.values()).sort((e,a)=>e.group_id-a.group_id)}),t=m(null),A=()=>{const o=document.createElement("script");o.src="//dapi.kakao.com/v2/maps/sdk.js?appkey=f0b2d739025f158d63463df9837d6e0c&autoload=false",o.onload=()=>{window.kakao.maps.load(M)},o.onerror=()=>new Error("Failed to load script"),document.head.appendChild(o)},D=m([]),k=m([]),T=m(),K=m(0),w=m(!1),M=()=>{try{const o=document.getElementById("map"),e={center:new window.kakao.maps.LatLng(36.450701,127.770667),level:13};t.value=new window.kakao.maps.Map(o,e);const a=new window.kakao.maps.ZoomControl;t.value.addControl(a,window.kakao.maps.ControlPosition.RIGHT),T.value=new window.kakao.maps.LatLngBounds,window.kakao.maps.event.addListener(t.value,"zoom_changed",function(){const s=t.value.getLevel();K.value=s,s<10?x(!0):x(!1)}),window.kakao.maps.event.addListener(t.value,"click",function(){t.value.getLevel()>=10&&x(!1)})}catch(o){console.error("Error loading Kakao Maps script:",o)}};function E(o){const e=o.latLng;if(!p)p=!0,b(),g(),h(),i=new window.kakao.maps.Polyline({map:t.value,path:[e],strokeWeight:5,strokeColor:"#db4040",strokeOpacity:1,strokeStyle:"solid"}),l=new window.kakao.maps.Polyline({strokeWeight:5,strokeColor:"#db4040",strokeOpacity:.5,strokeStyle:"solid"}),z(e,0);else{l.setMap(null),l=null;const a=i.getPath();a.push(e),i.setPath(a),h(),g();const s=Math.round(i.getLength())/1e3;z(e,s),p=!1}}function F(o){if(p){const e=o.latLng,a=i.getPath(),s=[a[a.length-1],e];l.setPath(s),l.setMap(t.value);const v=Math.round(i.getLength()+l.getLength()),L='<div class="bg-red-400/50 border px-1 text-sm">거리 <span class="number">'+v/1e3+"</span>km</div>";Z(L,e)}}const V=o=>{o?(window.kakao.maps.event.addListener(t.value,"click",E),window.kakao.maps.event.addListener(t.value,"mousemove",F)):(b(),g(),h(),l&&(l.setMap(null),l=null),p=!1,window.kakao.maps.event.removeListener(t.value,"click",E),window.kakao.maps.event.removeListener(t.value,"mousemove",F))},W=()=>{t.value&&f.centers.length!==0&&(t.value.setLevel(13),t.value.setCenter(new window.kakao.maps.LatLng(36.450701,127.770667)))},N=()=>{if(!t.value){console.warn("Map is not initialized yet");return}D.value.forEach(o=>o.setMap(null)),y.value.forEach(o=>{o.centers.forEach(e=>{let a=o.group_color?.replace("#","")||"888888",s="111111",v="fefefe";e.uncertain&&(a="ffffff",s="ff0000",v="ea0000");const L=`data:image/svg+xml,%3Csvg%20width%3D%22320px%22%20height%3D%22400px%22%20viewBox%3D%223%20-1%2030%2038%22%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20xmlns%3Axlink%3D%22http%3A%2F%2Fwww.w3.org%2F1999%2Fxlink%22%3E%20%20%3Cg%20stroke%3D%22none%22%20stroke-width%3D%221%22%20fill%3D%22none%22%20fill-rule%3D%22evenodd%22%3E%20%20%20%20%3Cg%20transform%3D%22translate%28-125.000000%2C%20-643.000000%29%22%3E%20%20%20%20%20%20%3Cg%20transform%3D%22translate%2837.000000%2C%20169.000000%29%22%3E%20%20%20%20%20%20%20%20%3Cg%20transform%3D%22translate%2878.000000%2C%20468.000000%29%22%3E%20%20%20%20%20%20%20%20%20%20%3Cg%20transform%3D%22translate%2814.000000%2C%206.000000%29%22%3E%20%20%20%20%20%20%20%20%20%20%20%20%3Cpath%20%20%20%20%20%20%20%20%20%20%20%20%20%20d%3D%22M14%2C0%20C21.732%2C0%2028%2C5.641%2028%2C12.6%20C28%2C23.963%2014%2C36%2014%2C36%20C14%2C36%200%2C24.064%200%2C12.6%20C0%2C5.641%206.268%2C0%2014%2C0%20Z%22%20%20%20%20%20%20%20%20%20%20%20%20%20%20id%3D%22Shape%22%20%20%20%20%20%20%20%20%20%20%20%20%20%20stroke%3D%22%23${s}%22%20%20%20%20%20%20%20%20%20%20%20%20%20%20fill%3D%22%23${a}%22%20%2F%3E%20%20%20%20%20%20%20%20%20%20%20%20%3Ccircle%20%20%20%20%20%20%20%20%20%20%20%20%20%20id%3D%22Oval%22%20%20%20%20%20%20%20%20%20%20%20%20%20%20fill%3D%22%23${v}%22%20%20%20%20%20%20%20%20%20%20%20%20%20%20fill-rule%3D%22nonzero%22%20%20%20%20%20%20%20%20%20%20%20%20%20%20cx%3D%2214%22%20%20%20%20%20%20%20%20%20%20%20%20%20%20cy%3D%2214%22%20%20%20%20%20%20%20%20%20%20%20%20%20%20r%3D%227%22%20%2F%3E%20%20%20%20%20%20%20%20%20%20%3C%2Fg%3E%20%20%20%20%20%20%20%20%3C%2Fg%3E%20%20%20%20%20%20%3C%2Fg%3E%20%20%20%20%3C%2Fg%3E%20%20%3C%2Fg%3E%3C%2Fsvg%3E`,C=new window.kakao.maps.Marker({image:new window.kakao.maps.MarkerImage(L,new window.kakao.maps.Size(32,35)),title:e.name,position:new window.kakao.maps.LatLng(e.lat,e.lng)});C.setMap(t.value),D.value.push(C);const U=`<div class ="bg-white/85 border border-gray-800 px-3 py-1.5 rounded-xl">        <div class="center font-bold">${e.name}</div>        <div class="text-sm">소속거점: ${e.group_name}</div>        <div class="text-sm">센터장: ${e.group_chief??"(미지정)"}</div>        <div class="text-sm">개소일: ${e.open_ymd??"(미확정)"}</div>      </div>`,H=C.getPosition(),P=new window.kakao.maps.CustomOverlay({position:H,content:U,yAnchor:1.43});window.kakao.maps.event.addListener(C,"click",function(){t.value.getLevel()>=10&&(k.value.forEach(R=>R.setMap(null)),P.setMap(t.value))}),k.value.push(P)})})},x=(o=!1)=>{o?k.value.forEach(e=>e.setMap(t.value)):k.value.forEach(e=>e.setMap(null))},j=o=>{if(!t.value)return;const e=new window.kakao.maps.LatLng(o.lat,o.lng);t.value.setCenter(e),t.value.setLevel(5)};let p=!1,l=null,i=null,r=null,c=[];function b(){i&&(i.setMap(null),i=null)}function Z(o,e){r?(r.setPosition(e),r.setContent(o)):r=new window.kakao.maps.CustomOverlay({map:t.value,content:o,position:e,xAnchor:0,yAnchor:0,zIndex:3})}function g(){r&&(r.setMap(null),r=null)}function z(o,e){const a=new window.kakao.maps.CustomOverlay({content:'<span class="dot bg-white"></span>',position:o,zIndex:1});a.setMap(t.value),e>0&&(r=new window.kakao.maps.CustomOverlay({content:'<div class="bg-white border rounded-md px-1 text-sm">거리 <span class="number">'+e+"</span>km</div>",position:o,yAnchor:1,zIndex:2}),r.setMap(t.value)),c.push({circle:a,distance:r})}function h(){for(let o=0;o<c.length;o++)c[o].circle&&c[o].circle.setMap(null),c[o].distance&&c[o].distance.setMap(null);c=[]}const S=o=>{(o.key==="Escape"||o.key==="Esc"||o.key==="Delete")&&(b(),g(),h(),l&&(l.setMap(null),l=null),p=!1)};return J(()=>{!window.kakao||!window.kakao.maps?(console.log("Kakao Maps script not loaded, loading now..."),A()):(console.log("Kakao Maps script already loaded"),M()),document.addEventListener("keyup",S)}),Q(()=>{document.removeEventListener("keyup",S)}),X(()=>f.centers,o=>{N()},{deep:!0}),(o,e)=>(u(),d("div",ie,[n("div",ce,[e[3]||(e[3]=n("section",{class:"inline-flex items-center"},[n("h3",{class:"mr-4 text-xl font-black text-gray-700"},"EBS 자기주도학습센터 지도"),n("a",{href:"/manager/list",class:"rounded-full border border-sky-600 px-4 py-0.5 text-sky-800"},"센터 리스트 보기")],-1)),n("section",de,[n("div",ue,[G(n("input",{type:"checkbox",id:"gpsCheck","onUpdate:modelValue":e[0]||(e[0]=a=>w.value=a),onChange:e[1]||(e[1]=a=>V(w.value)),class:"mr-1 h-4 w-4 cursor-pointer"},null,544),[[ee,w.value]]),e[2]||(e[2]=n("label",{for:"gpsCheck",class:"cursor-pointer text-sm select-none"},"거리재기",-1))]),w.value?(u(),d("div",pe,"※거리표시 지우기: ESC or DEL 키")):Y("",!0),n("div",{class:"ml-auto cursor-pointer rounded-full border border-gray-600 px-4 py-0.5 text-gray-600 hover:bg-gray-100",onClick:W}," 전체 지도 ")])]),n("div",me,[n("div",ve,[(u(!0),d($,null,I(y.value,a=>(u(),d("div",{key:a.group_id,class:"mb-1"},[(u(!0),d($,null,I(a.centers,s=>(u(),d("div",{key:s.id,class:"mb-1"},[n("div",{class:"flex w-full cursor-pointer items-center py-0.5 hover:bg-amber-100",onClick:v=>j(s)},[n("span",{class:"mr-2 ml-1 rounded-full px-1.5 py-0.5",style:ae([{backgroundColor:a.group_color??"#888888",color:te(re)(a.group_color??"#888888").color},{"font-size":"x-small"}])},_(s.group_name),5),oe(" "+_(s.name)+" "+_(s.group_chief?`(${s.group_chief})`:"(미지정)")+" ",1),n("span",{class:se(["mr-2 ml-1 rounded-full px-1 text-white",{"bg-amber-600":s.is_moe_budget,"bg-blue-400":!s.is_moe_budget}]),style:{"font-size":"x-small"}},_(s.is_moe_budget?"특교":"지자체"),3)],8,fe)]))),128))]))),128))])])]))}}),we={class:"map-container"},Ce=B({__name:"MapView",setup(O){return(f,y)=>(u(),d("div",we,[ne(ke)]))}});export{Ce as default};
